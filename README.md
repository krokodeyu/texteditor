# Lab1 – 命令行文本编辑器（Rust）

本项目实现一个**基于命令行**的文本编辑器，支持同时打开多个文本文件，并包含**工作区管理、日志记录与状态持久化**等能力。  
实验重点包括面向对象建模、模块化与设计模式，以及自动化测试；统一使用 UTF-8 编码。

---

## 目录

- [目标与范围](#%E7%9B%AE%E6%A0%87%E4%B8%8E%E8%8C%83%E5%9B%B4)

- [功能清单&进度追踪](#%E5%8A%9F%E8%83%BD%E6%B8%85%E5%8D%95%E8%BF%9B%E5%BA%A6%E8%BF%BD%E8%B8%AA)

- [设计说明（概要）](#%E8%AE%BE%E8%AE%A1%E8%AF%B4%E6%98%8E%E6%A6%82%E8%A6%81)

- [开发&运行](#%E5%BC%80%E5%8F%91%E8%BF%90%E8%A1%8C)

- [测试计划](#%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92)

- [里程碑与时间表](#%E9%87%8C%E7%A8%8B%E7%A2%91%E4%B8%8E%E6%97%B6%E9%97%B4%E8%A1%A8)

- [提交清单（DDL/打包要求）](#%E6%8F%90%E4%BA%A4%E6%B8%85%E5%8D%95ddL%E6%89%93%E5%8C%85%E8%A6%81%E6%B1%82)

- [Changelog（开发日志模板）](#changelog%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97%E6%A8%A1%E6%9D%BF)

---

## 目标与范围

- **Workspace（工作区）**：管理打开文件列表、活动文件、修改状态、日志开关；负责退出时将状态写入 `.editor_workspace`，下次启动恢复；对外发布事件供日志订阅。  
  持久化需包含：打开文件、活动文件、modified 标记与日志开关；不需要持久化 undo/redo 历史与编辑时长。

- **TextEditor（文本编辑器）**：追加/插入/删除/替换与按行范围显示，任何编辑操作后标记为“已修改”，并提供越界等错误反馈；数据结构使用**行数组**，保存时用 `\n` 连接。

- **Logging（日志）**：若文件首行是 `# log` 则自动启用；记录每条命令与时间戳；每次启动视为新会话（`session start at ...`）；支持 `log-on/log-off/log-show`；日志写在**同目录**的 `.filename.log`；失败只警告不影响主流程。

> 参数约定：`<file>` 为路径；`line:col` 为 1-based 定位；带空格文本用引号；命令参数区分大小写。

---

## 功能清单&进度追踪

> 打勾即可同步你当前进度；命令合计 **18 个**（评分基础分 60，**每缺 1 个扣 5 分**）。

### 工作区命令（10）

- [x] `load <file>`（存在即读，不存在则新建并置活动） 

- [x] `save [file|all]`（成功清除 modified，无法写入需报错）

- [x] `init <file> [with-log]`（首行可写 `# log`）

- [x] `close [file]`

- [x] `edit <file>`

- [x] `editor-list`

- [x] `dir-tree [path]`

- [x] `undo`

- [x] `redo`

- [x] `exit`（退出前保存工作区；对未保存文件逐一提示）

### 文本编辑命令（5）

- [x] `append "text"`（在末尾追加一行）

- [x] `insert <line:col> "text"`（支持 `\n` 拆多行；校验越界与空文件非 1:1）

- [x] `delete <line:col> <len>`（不可跨行；长度不能超出行尾）

- [x] `replace <line:col> <len> "text"`（等同先删再插）

- [x] `show [start:end]`（按行范围显示）

### 日志命令（3）

- [x] `log-on [file]`

- [x] `log-off [file]`（停止监听但不删除已有日志）

- [x] `log-show [file]`（输出 `.filename.log` 内容）

---

## 设计说明（概要）

- **模块与依赖**：`Workspace` 持有 `Editor` 实例集合并派发命令；`Logging` 作为观察者订阅命令事件（Observer）。`Workspace` 将关键状态打包为**备忘录**进行持久化（Memento）。

- **数据结构**：文本内部用 `Vec<String>` 的**行数组**表示，便于行号定位与范围操作；保存时用 `\n` 拼接。

- **Undo/Redo**：建议以命令模式封装可逆操作，为 `undo/redo` 提供统一回滚/重做接口。

> 详细设计（模块职责/依赖、设计模式说明、运行与测试说明、测试用例结果）需要在提交时附带成文档。

---

## 开发&运行

`# 运行（开发态） cargo run  # 检查代码风格 / 诊断 cargo fmt --all cargo clippy --all-targets -- -D warnings  # 发布构建 cargo build --release`

**命令参数约定**（再次提示）：`line:col` 1-based；带空格文本请使用引号。

---

## 测试计划

- **层次化测试**：按层编写单测；覆盖 Workspace、TextEditor 的关键边界与异常分支；评分要求强调“每层有测试，不限覆盖率”。

- **命令端到端测试**：对 18 条命令构造脚本/快照比对；重点校验越界、空文件 1:1 插入、删除长度越界、保存失败等。

---

## 里程碑与时间表

> 评分构成：架构 15 + 测试 15 + 命令实现 60 + 代码质量 10。

- **M1（基础通路）**：
  
  完成`load/save/init/append/show/undo/redo` 与最小日志读取；落地 `.editor_workspace` 的读写骨架。编写测试。

- **M2（文本四件套）**：
  
  插入/删除/替换的边界与错误；加 `edit/editor-list/close`。

- **M3（工作区完善）**：`dir-tree/exit`（退出前保存与提示）。

- **M4（日志命令）**：`log-on/log-off/log-show` 与会话头写入。

> 建议把每个里程碑对应到一个 Git 分支与 PR，合并前跑 `fmt + clippy + test` CI。

---

## 提交清单（DDL/打包要求）

- **DDL**：2025-11-24 23:59。

- **打包**：`学号_姓名.zip`，包含：
  
  1. **源代码**（结构清晰，不要包含第三方库源代码）；
  
  2. **架构设计文档**（模块划分/职责/依赖、设计模式、运行说明与测试说明）；
  
  3. **测试文档**（用例列表与执行结果）。
